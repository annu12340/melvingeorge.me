{"pageProps":{"content":"# Progressive image loading in reactjs\n<p className=\"date\">Published June 1, 2020</p>\n\n![banner image](main.png)\n\n## Contents\n\n- [Install Package](#install-package)\n- [Adding Webpack Config](#adding-webpack-config)\n- [Writing the Image Loader Component](#writing-the-image-loader)\n- [Logic behind rendering images](#logic-behind-rendering-images)\n- [Adding CSS to Image loader](#adding-css-to-image-loader)\n- [Import anywhere and use it](#import-anywhere-and-use-it)\n- [Github Repo of this Code](#github-repo-link)\n\n## <a name=\"install-package\"></a> Install package\n\nRun in the terminal :\n\n```bash\nnpm install --save-dev image-trace-loader\n```\n\n## <a name=\"adding-webpack-config\"></a> Adding Webpack config\n\nNothing serious to do! Chill ü•∂\n\nWe just need to add `image-trace-loader` to our Webpack config which will help in loading the different image extensions.\n\n### If you are using `create-react-app` :\n\nThen we need to use an additional command called the `eject` command to get our webpack config.\n\nRun in terminal to eject :\n\n```bash\nnpm run eject\n```\n\nYou can now see a folder structure which looks like this:\n\n![Folder structure](folder-structure.png \"Folder Structure\")\n\nGo to `config` folder and open `webpack.config.js`\n\nNow we need to find the rules for image extensions that are already defined in this configuration file.\n\nFor that, we can use `Ctrl + F` to open finder in the editor and search for `png`.\n\nThere's only one reference to `png` in the entire file so it becomes easy for us.\n\nNow you will see some rules already defined for image extensions which looks like this:\n\n```javascript\n// predefined rules for images\n{\n  test: [/\\.bmp$/, /\\.gif$/, /\\.jpe?g$/, /\\.png$/],\n  loader: require.resolve('url-loader'),\n  options: {\n    limit: imageInlineSizeLimit,\n    name: 'static/media/[name].[hash:8].[ext]',\n  },\n}\n```\n\nRemove the old object and add this object there:\n\n```javascript\n{\n  test: [/\\.bmp$/, /\\.gif$/, /\\.jpe?g$/, /\\.png$/],\n  use: [\n    // adding image-trace-loader\n    {\n      loader: \"image-trace-loader\",\n    },\n    {\n      loader: \"url-loader\",\n      options: {\n        limit: imageInlineSizeLimit,\n        name: \"static/media/[name].[hash:8].[ext]\",\n      },\n    },\n  ],\n}\n```\n\nNote that we added the :\n\n```javascript\n{\n  loader: \"image-trace-loader\",\n},\n```\n\nAn important thing to note here is that we are adding the `image-trace-loader` to work together with `url-loader`.\n\nThat's all! ü§ì\n\n### If you are using custom webpack configuration :\n\nAdd this to config for webpack to recognize image extensions:\n\n```javascript\nmodule.exports = {\n  module: {\n    rules: [\n      {\n        test: /\\.(gif|png|jpe?g)$/i,\n        use: [\n          {\n            loader: \"image-trace-loader\",\n          },\n        ],\n      },\n    ],\n  },\n};\n```\n\nWonderful! ü•≥\n\n## <a name=\"writing-the-image-loader\"></a>Writing the Image Loader Component\n\n- Create a component called `ImageLoader`.\n\n```javascript\nimport React, { useState } from \"react\";\n\nconst ImageLoader = () => {};\n\nexport default ImageLoader;\n```\n\n- Make a state for the images so that we can trigger loading state or loaded state and show appropriate images - initially set to `false`.\n\n```javascript\nimport React, { useState } from \"react\";\n\nconst ImageLoader = () => {\n  // state of images\n  const [imageLoaded, setImageLoaded] = useState(false);\n};\n\nexport default ImageLoader;\n```\n\n- Define props for the component called `source` and `alt`.\n\n```javascript\nimport React, { useState } from \"react\";\n\n// Props: source, alt\nconst ImageLoader = ({ source, alt }) => {\n  // state of images\n  const [imageLoaded, setImageLoaded] = useState(false);\n};\n\nexport default ImageLoader;\n```\n\n- We need to import the image using the `require` function and pass it the value of prop `source`.\n\n- This gives us two URLs of images:\n\n  `src` - the real image url\n\n  `trace` - the SVG trace image url ( used to show when the image is loading )\n\n```javascript\nimport React, { useState } from \"react\";\n\n// Props: source, alt\nconst ImageLoader = ({ source, alt }) => {\n  // state of images\n  const [imageLoaded, setImageLoaded] = useState(false);\n\n  // src image and trace image url\n  const { src, trace } = require(`./${source}`);\n};\n\nexport default ImageLoader;\n```\n\n## <a name=\"logic-behind-rendering-images\"></a>Logic behind rendering images\n\n- Ideally, we want both images to be stacked only then we would be able to show the loading image (SVG trace image) when the image is loading\n\n```javascript\nimport React, { useState } from \"react\";\n\n// Props: source, alt\nconst ImageLoader = ({ source, alt }) => {\n  // state of images\n  const [imageLoaded, setImageLoaded] = useState(false);\n\n  // src image and trace image url\n  const { src, trace } = require(`./${source}`);\n\n  // render code\n  return (\n    <div>\n      <img\n        src={src}\n        alt={alt}\n        loading=\"lazy\"\n        style={{\n          opacity: imageLoaded ? \"1\" : \"0\",\n        }}\n        onLoad={() => setImageLoaded(true)}\n      />\n\n      <img\n        style={{\n          opacity: imageLoaded ? \"0\" : \"1\",\n        }}\n        src={trace}\n        alt={alt}\n      />\n    </div>\n  );\n};\n\nexport default ImageLoader;\n```\n\nIn the above code, we see the `onLoad` event in the first `img` tag. This will be called when the original image is fully loaded and rendered. Here we need to set the state of `imageLoaded` state to `true`.\n\nBoth the image tags have the style attributes. When the state is changed from `false` to `true` the original image opacity will be set to `1` from `0` and the opacity of trace image will be set to `0` from `1`.\n\nThis is because we want the trace image to disappear and show the original image when it's loaded.\n\n## <a name=\"adding-css-to-image-loader\"></a>Adding CSS to Image loader\n\nThis the CSS we need to use to make it work.\n\n```css\n.imageLoader {\n  height: 50vh;\n  margin: 0 auto;\n  position: relative;\n}\n\n.imageLoader img {\n  height: 100%;\n}\n\n.imageLoader .realImg {\n  position: absolute;\n  top: 0;\n  left: 0;\n  transition-property: background-color, border-color, color, fill, stroke,\n    opacity, box-shadow, transform;\n  transition-property: all;\n  transition-duration: 300ms;\n  transition-timing-function: cubic-bezier(0, 0, 0.2, 1);\n}\n```\n\nlet's import this CSS file into our `ImageLoader` component.\n\n```javascript\nimport React, { useState } from \"react\";\nimport \"./ImageLoader.css\";\n\nconst ImageLoader = ({ source, alt }) => {\n  .\n  .\n  .\n}\n```\n\nHere we need to understand 2 things,\n\n- `.imageLoader` class\n- `.realImg` class\n\n### `.imageLoader` class :\n\nif you look closely you can see that we have defined\n\n```css\nposition: relative;\n```\n\nin our class.\n\nThis class is added to the wrapper of the 2 image tags. So that wrapper is now considered as the starting point of 2 img tags.\n\nlet's add this class to our wrapper now.\n\n```javascript\n// render code\nreturn (\n  // add .imageLoader class\n  // to wrapper\n  <div className=\"imageLoader\">\n    <img\n      src={src}\n      alt={alt}\n      loading=\"lazy\"\n      style={{\n        opacity: imageLoaded ? \"1\" : \"0\",\n      }}\n      onLoad={() => setImageLoaded(true)}\n    />\n\n    <img\n      style={{\n        opacity: imageLoaded ? \"0\" : \"1\",\n      }}\n      src={trace}\n      alt={alt}\n    />\n  </div>\n);\n```\n\n### `.realImg` class :\n\nhere we have,\n\n```css\nposition: absolute;\ntop: 0;\nleft: 0;\n```\n\ndefined.\n\nWe need to add this class to our original img tag. This makes sure that our original image starts rendering from the top-left region relative to the wrapper.\n\nlet's add it now.\n\n```javascript\n// render code\nreturn (\n  // add .imageLoader class\n  // to wrapper\n  <div className=\"imageLoader\">\n    // add .realImg class here\n    <img\n      className=\"realImg\"\n      src={src}\n      alt={alt}\n      loading=\"lazy\"\n      style={{\n        opacity: imageLoaded ? \"1\" : \"0\",\n      }}\n      onLoad={() => setImageLoaded(true)}\n    />\n    <img\n      style={{\n        opacity: imageLoaded ? \"0\" : \"1\",\n      }}\n      src={trace}\n      alt={alt}\n    />\n  </div>\n);\n```\n\nüôåüèª Wonderfull! You just made a cool image loader.\n\n## <a name=\"import-anywhere-and-use-it\"></a> Import anywhere and use it\n\n```javascript\nimport ImageLoader from \"./ImageLoader\";\n\nconst App = () => <ImageLoader source=\"img.jpg\" alt=\"An image\" />;\n\nexport default App;\n```\n\n### <a name=\"github-repo-link\" href=\"https://github.com/melvin2016/progressive-image-loading\" target=\"blank\"> Github Repo of this Code </a>\n\n### This is my first blog. Feel free to share if you found this useful üòÉ.\n","frontMatter":{"title":"Progressive image loading in reactjs","description":"Create a supercool image loading effect using SVG trace","keywords":"progressive-image-loading,javascript,reactjs,image-trace-loader","category":"Reactjs","author":"MELVIN GEORGE","date":"June 1, 2020","link":"progressive-image-loading"}},"__N_SSG":true}